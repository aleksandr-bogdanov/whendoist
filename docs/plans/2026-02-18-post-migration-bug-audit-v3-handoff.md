# Handoff: Post-Migration Bug Audit v3

## Context

Whendoist recently migrated from Python (Jinja2 templates + vanilla JS) to a React SPA frontend. This caused many bugs. Three rounds of analysis have been performed:

- **v1** (`docs/plans/2026-02-18-fix-post-rework-frontend-bugs.md`, PR #337) — Route collision + settings crash. Both fixed.
- **v2** (`docs/plans/2026-02-18-post-migration-bug-audit-v2.md`, PR #342) — 16 issues found, 12 fixed. Remaining deferred: stale openapi.json (#9), type casts (#15), module-level shortcut array (#14).
- **v3** (`docs/plans/2026-02-18-post-migration-bug-audit-v3.md`) — **Current round. 19 issues found. None fixed yet.**

The user explicitly asked to **disregard performance and encryption issues** — those will be separate topics.

## What Was Completed

**Research only — no code changes were made.** The v3 audit plan was written to `docs/plans/2026-02-18-post-migration-bug-audit-v3.md` with 19 issues organized by severity. The plan file has no `version` or `pr` set yet (pending implementation).

## The 19 Issues (from v3 plan)

### CRITICAL — Features broken or missing after migration

| # | Issue | File(s) | Summary |
|---|-------|---------|---------|
| 1 | Recurring instances absent from calendar | `calendar-panel.tsx`, `day-column.tsx` | All 9 `/api/v1/instances` endpoints are unused. Recurring tasks invisible in calendar. |
| 2 | "Skip Instance" button is a no-op | `task-action-sheet.tsx:138-143` | `onClick={close}` — just dismisses the sheet |
| 3 | Thoughts: no delete, edit, or promote | `thoughts.tsx` | ThoughtBubble is purely presentational |
| 4 | No deleted/trash section | — | Backend soft-deletes + has restore endpoint, but no UI to list/restore archived tasks |
| 5 | Backup export & snapshot download missing | `settings.tsx` | `GET /backup/export` and `GET /backup/snapshots/{id}/download` never called |

### HIGH — UX bugs

| # | Issue | File(s) | Summary |
|---|-------|---------|---------|
| 6 | Swipe-complete doesn't cascade subtasks | `domain-group.tsx:61-75` | Checkbox click cascades, swipe doesn't |
| 7 | Mobile delete has no undo | `task-action-sheet.tsx:110-121` | Desktop shows undo toast, mobile just `toast.info` |
| 8 | Plan Mode sends N sequential API calls | `plan-mode.tsx:59-73` | `for` loop with `await` — should be parallel |
| 9 | Sort/filter state lost on reload | `ui-store.ts:99-104` | `sortField`, `sortDirection`, `showScheduled`, `showCompleted` not in `partialize` |
| 10 | Domain expand/collapse resets on reload | `ui-store.ts:48-49` | `Set<number>` not serializable, excluded from persist |
| 11 | Calendar time indicator frozen | `day-column.tsx:50-53` | `new Date()` captured once, never updates |
| 12 | Swipe-left doesn't schedule specific task | `domain-group.tsx:112-115` | Just switches to calendar tab, no task context passed |

### MEDIUM — Correctness

| # | Issue | File(s) | Summary |
|---|-------|---------|---------|
| 13 | Wizard domain remove doesn't delete from server | `onboarding-wizard.tsx:391` | Removes from local state only |
| 14 | Swipe vertical detection uses wrong value | `task-swipe-row.tsx:87` | `my` is absolute clientY vs relative mx |
| 15 | Passkey module uses raw axios | `passkey.ts:315` | Bypasses apiClient interceptors |

### LOW — Polish

| # | Issue | File(s) | Summary |
|---|-------|---------|---------|
| 16 | `showCompleted` defaults to `false` | `ui-store.ts:16` | Old site defaulted `true` |
| 17 | Analytics missing 2 widget types | `analytics.tsx` | No "Recent Completions" or "Resolution Time" |
| 18 | Thoughts missing date separators | `thoughts.tsx` | Old site grouped by date with visual separators |
| 19 | No error boundary for crash protection | `_authenticated.tsx` | Uncaught render error = white screen |

## Recommended Fix Order (from plan)

**Phase 1 — Critical feature gaps:** #1 (instances in calendar), #3 (thoughts interactivity), #4 (trash section)
**Phase 2 — High bugs (quick wins):** #6, #7, #9, #11, #2
**Phase 3 — Medium/Low polish:** #5, #8, remaining

## Decisions Made

- Encryption and performance issues are **out of scope** for this round
- The plan recommends phased implementation but the user hasn't approved a specific order yet
- No code was modified — this was purely research/documentation

## Key Files to Know

- **Plan file:** `docs/plans/2026-02-18-post-migration-bug-audit-v3.md` (full details with code snippets)
- **Frontend source:** `frontend/src/` (React + TypeScript + Vite)
- **API hooks:** Auto-generated by orval (`frontend/src/api/queries/`)
- **UI state:** Zustand store at `frontend/src/stores/ui-store.ts`
- **Backend routers:** `app/routers/` (FastAPI)
- **Instance API:** `app/routers/instances.py` (9 endpoints, all unused by frontend)

## What Remains

The user needs to decide which issues to fix and in what order. Then implementation begins — likely as one or more PRs following the project's versioned PR workflow (`v{version}/{type}: Description`).

## Blockers

None. All issues have clear fixes described in the plan file.
