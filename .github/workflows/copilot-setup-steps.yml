name: Copilot Setup Steps

on:
  workflow_call:

jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"

      - name: Set up Python
        run: uv python install 3.13

      - name: Install dependencies
        run: uv sync --all-extras

      - name: Verify environment
        env:
          SECRET_KEY: test-secret-key-for-ci
          BASE_URL: http://localhost:8000
          TODOIST_CLIENT_ID: test
          TODOIST_CLIENT_SECRET: test
          GOOGLE_CLIENT_ID: test
          GOOGLE_CLIENT_SECRET: test
        run: |
          uv run ruff check --version
          uv run pyright --version
          uv run pytest --co -q -m "not integration" 2>/dev/null | tail -1
