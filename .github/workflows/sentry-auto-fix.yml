# =============================================================================
# Sentry Auto-Fix with GitHub Copilot
# =============================================================================
#
# When Sentry creates a GitHub issue, this workflow auto-assigns it to Copilot.
# Copilot coding agent then investigates the error and opens a draft fix PR.
#
# Prerequisites:
#   1. Sentry GitHub integration enabled (auto-creates issues with stack traces)
#   2. GitHub Copilot subscription (Pro, Pro+, Business, or Enterprise)
#
# How it works:
#   Sentry error → alert fires → GitHub issue created → auto-assigned to
#   @copilot → Copilot agent reads issue + codebase → creates draft fix PR
# =============================================================================

name: Sentry Auto-Fix

on:
  issues:
    types: [opened]

jobs:
  assign-copilot:
    # Trigger on issues that look like they came from Sentry
    if: >
      contains(github.event.issue.body, 'sentry.io') ||
      contains(github.event.issue.labels.*.name, 'sentry')
    runs-on: ubuntu-latest

    permissions:
      issues: write

    steps:
      - name: Assign to Copilot
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              assignees: ['copilot']
            });
