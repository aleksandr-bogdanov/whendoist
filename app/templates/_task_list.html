{# Task List Partial - used by dashboard and HTMX refreshes #}

{# Import task item macro #}
{% from '_task_item_macro.html' import render_task_item %}

{# â”€â”€ Plan My Day contextual banner â”€â”€ #}
<div class="pmd-banner" id="pmd-banner" hidden>
    <div class="pmd-banner-text">
        <span class="pmd-banner-title" id="pmd-banner-title">Plan tomorrow?</span>
        <span class="pmd-banner-sub" id="pmd-banner-sub"></span>
    </div>
    <div class="pmd-banner-actions">
        <button type="button" class="pmd-banner-btn" id="pmd-banner-btn">Plan</button>
        <button type="button" class="pmd-banner-dismiss" id="pmd-banner-dismiss" aria-label="Dismiss">&times;</button>
    </div>
</div>

{# â”€â”€ Active tasks â€” grouped by domain â”€â”€ #}
{% if domain_groups %}
    {% for domain_item in domain_groups %}
    <details class="project-group" {% if domain_item.domain %}open{% endif %} data-domain-id="{{ domain_item.domain.id if domain_item.domain else 'inbox' }}"{% if domain_item.domain %} data-domain-name="{{ domain_item.domain.name }}"{% endif %}>
        <summary class="project-header">
            <span class="project-name">
                {% if domain_item.domain %}
                    {% if domain_item.domain.icon %}{{ domain_item.domain.icon }} {% endif %}<span class="domain-name-text">{% if encryption_enabled %}ðŸ”’{% else %}{{ domain_item.domain.name }}{% endif %}</span>
                {% else %}
                    Thoughts
                {% endif %}
            </span>
            <span class="task-count">{{ domain_item.tasks|length }}</span>
            <span class="header-spacer"></span>
            <button type="button" class="domain-add-btn" data-domain-id="{{ domain_item.domain.id if domain_item.domain else '' }}" aria-label="Add task"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><use href="#plus"/></svg></button>
        </summary>
        <div class="task-list">
            {% for task_item in domain_item.tasks %}
            {{ render_task_item(task_item, today, encryption_enabled) }}
            {% endfor %}
            <div class="add-task-row" data-domain-id="{{ domain_item.domain.id if domain_item.domain else '' }}">
                <span class="add-task-icon">+</span>
                <span class="add-task-text">Add task</span>
            </div>
        </div>
    </details>
    {% endfor %}
{% else %}
<div class="empty-state">
    <img src="{{ url_for('static', path='img/illustrations/empty-tasks.svg') }}" alt="" class="empty-state-illustration" width="120" height="120" aria-hidden="true">
    <p>No tasks with domains yet.</p>
    <p>Create a domain in Settings, then promote thoughts to tasks.</p>
</div>
{% endif %}

{# â”€â”€ Scheduled tasks â€” collapsible section â”€â”€ #}
{% if scheduled_tasks %}
<details class="section-group" id="section-sched"{% if user_prefs.show_scheduled_in_list %} open{% endif %}>
    <summary class="section-separator section-separator--sched">
        <span class="sched-label-group">
            <span class="section-sep-label">Scheduled</span>
            <span class="section-count">{{ scheduled_tasks|length }}</span>
            <span class="past-badge" id="past-badge" hidden></span>
            <span class="sched-label-line"></span>
            <span class="sep-col-label">Date</span>
        </span>
        <span class="sep-col-label">Clarity</span>
        <span class="sep-col-label">Dur</span>
        <span class="sep-col-label">Impact</span>
        <span class="sep-col-spacer"></span>
    </summary>
    <div class="section-tasks">
        {% for task_item in scheduled_tasks %}
        {{ render_task_item(task_item, today, encryption_enabled) }}
        {% endfor %}
    </div>
</details>
{% endif %}

{# â”€â”€ Completed tasks â€” collapsible section â”€â”€ #}
{% if completed_tasks %}
<details class="section-group" id="section-done"{% if user_prefs.show_completed_in_list %} open{% endif %}>
    <summary class="section-separator">
        <span class="section-sep-label">Completed</span>
        <span class="section-count">{{ completed_tasks|length }}</span>
    </summary>
    <div class="section-tasks">
        {% for task_item in completed_tasks %}
        {{ render_task_item(task_item, today, encryption_enabled) }}
        {% endfor %}
    </div>
</details>
{% endif %}
