{% extends "base.html" %}

{% block title %}Settings - Whendoist{% endblock %}

{% block extra_css %}
<style>
/* Settings Page Styles */
.settings-layout {
    max-width: 800px;
    margin: 0 auto;
}

.settings-header {
    margin-bottom: 2rem;
}

.settings-header h1 {
    margin: 0 0 0.5rem 0;
    font-size: 1.75rem;
    color: #1e293b;
}

.settings-header p {
    margin: 0;
    color: #64748b;
    font-size: 0.95rem;
}

/* Section Card */
.settings-section {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.section-header {
    padding: 1rem 1.25rem;
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
}

.section-header h2 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
}

.section-content {
    padding: 1.25rem;
}

/* Connection Cards */
.connection-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.connection-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    transition: all 0.15s ease;
}

.connection-card:hover {
    border-color: #cbd5e1;
}

.connection-card.connected {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    border-color: #86efac;
}

.connection-icon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
    border-radius: 10px;
    font-size: 1.5rem;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.connection-info {
    flex: 1;
}

.connection-name {
    font-weight: 600;
    font-size: 0.95rem;
    color: #1e293b;
    margin-bottom: 0.25rem;
}

.connection-status {
    font-size: 0.8rem;
    color: #64748b;
}

.connection-status.connected {
    color: #16a34a;
}

.connection-action {
    flex-shrink: 0;
}

.btn-connect {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: #fff;
    border: none;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.15s ease;
}

.btn-connect:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}

/* Calendar List */
.calendar-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.calendar-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    transition: all 0.15s ease;
}

.calendar-item:hover {
    border-color: #cbd5e1;
}

.calendar-color {
    width: 12px;
    height: 12px;
    border-radius: 3px;
    flex-shrink: 0;
}

.calendar-info {
    flex: 1;
    min-width: 0;
}

.calendar-name {
    font-size: 0.9rem;
    font-weight: 500;
    color: #1e293b;
}

.calendar-badge {
    font-size: 0.65rem;
    font-weight: 500;
    background: #dbeafe;
    color: #1d4ed8;
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    margin-left: 0.5rem;
}

.calendar-toggle {
    flex-shrink: 0;
}

.toggle-btn {
    padding: 0.375rem 0.75rem;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s ease;
    background: #fff;
    color: #64748b;
}

.toggle-btn.enabled {
    background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
    border-color: #86efac;
    color: #166534;
}

.toggle-btn:hover {
    border-color: #cbd5e1;
}

.empty-calendars {
    text-align: center;
    padding: 2rem;
    color: #94a3b8;
    font-size: 0.9rem;
}

/* Reference Section */
.reference-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
}

.reference-block h3 {
    font-size: 0.85rem;
    font-weight: 600;
    color: #1e293b;
    margin: 0 0 0.75rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #e2e8f0;
}

.reference-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.reference-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.85rem;
}

.ref-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 50px;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
}

.ref-badge.impact-high { background: #fee2e2; color: #dc2626; }
.ref-badge.impact-med { background: #ffedd5; color: #ea580c; }
.ref-badge.impact-low { background: #dbeafe; color: #2563eb; }
.ref-badge.impact-none { background: #f1f5f9; color: #94a3b8; }

.ref-badge.clarity-exec { background: #dcfce7; color: #166534; }
.ref-badge.clarity-def { background: #fef9c3; color: #854d0e; }
.ref-badge.clarity-exp { background: #ede9fe; color: #5b21b6; }

.ref-desc {
    color: #64748b;
}

.ref-label {
    font-family: ui-monospace, monospace;
    font-size: 0.75rem;
    color: #6366f1;
    background: #eef2ff;
    padding: 0.125rem 0.375rem;
    border-radius: 3px;
}

/* Energy Info */
.energy-info {
    margin-top: 1.25rem;
    padding-top: 1.25rem;
    border-top: 1px solid #e2e8f0;
}

.energy-info h3 {
    font-size: 0.85rem;
    font-weight: 600;
    color: #1e293b;
    margin: 0 0 0.75rem 0;
}

.energy-list {
    display: flex;
    gap: 1rem;
}

.energy-item {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background: #f8fafc;
    border-radius: 6px;
    font-size: 0.8rem;
}

.energy-num {
    font-weight: 700;
    color: #6366f1;
}

.energy-desc {
    color: #64748b;
}

@media (max-width: 600px) {
    .connection-grid,
    .reference-grid {
        grid-template-columns: 1fr;
    }

    .energy-list {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="settings-layout">
    <header class="settings-header">
        <h1>Settings</h1>
        <p>Manage your integrations and preferences</p>
    </header>

    <!-- Connections Section -->
    <section class="settings-section">
        <div class="section-header">
            <h2>Integrations</h2>
        </div>
        <div class="section-content">
            <div class="connection-grid">
                <div class="connection-card {% if todoist_connected %}connected{% endif %}">
                    <div class="connection-icon">T</div>
                    <div class="connection-info">
                        <div class="connection-name">Todoist</div>
                        <div class="connection-status {% if todoist_connected %}connected{% endif %}">
                            {% if todoist_connected %}Connected{% else %}Not connected{% endif %}
                        </div>
                    </div>
                    {% if not todoist_connected %}
                    <div class="connection-action">
                        <a href="/auth/todoist" class="btn-connect">Connect</a>
                    </div>
                    {% endif %}
                </div>

                <div class="connection-card {% if google_connected %}connected{% endif %}">
                    <div class="connection-icon">G</div>
                    <div class="connection-info">
                        <div class="connection-name">Google Calendar</div>
                        <div class="connection-status {% if google_connected %}connected{% endif %}">
                            {% if google_connected %}Connected{% else %}Not connected{% endif %}
                        </div>
                    </div>
                    {% if not google_connected %}
                    <div class="connection-action">
                        <a href="/auth/google" class="btn-connect">Connect</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <!-- Calendars Section -->
    {% if google_connected %}
    <section class="settings-section">
        <div class="section-header">
            <h2>Calendars</h2>
        </div>
        <div class="section-content">
            {% if calendars %}
            <div class="calendar-list">
                {% for cal in calendars %}
                <div class="calendar-item">
                    <div class="calendar-color" style="background-color: {{ cal.background_color }};"></div>
                    <div class="calendar-info">
                        <span class="calendar-name">{{ cal.summary }}</span>
                        {% if cal.primary %}<span class="calendar-badge">Primary</span>{% endif %}
                    </div>
                    <div class="calendar-toggle">
                        <button
                            class="toggle-btn {% if cal.enabled %}enabled{% endif %}"
                            hx-post="/api/calendars/{{ cal.id }}/toggle"
                            hx-swap="none"
                            hx-on::after-request="this.classList.toggle('enabled'); this.textContent = this.classList.contains('enabled') ? 'Enabled' : 'Disabled'"
                        >
                            {{ 'Enabled' if cal.enabled else 'Disabled' }}
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-calendars">No calendars found</div>
            {% endif %}
        </div>
    </section>
    {% endif %}

    <!-- Quick Reference Section -->
    <section class="settings-section">
        <div class="section-header">
            <h2>Quick Reference</h2>
        </div>
        <div class="section-content">
            <div class="reference-grid">
                <div class="reference-block">
                    <h3>Impact (Todoist Priority)</h3>
                    <div class="reference-list">
                        <div class="reference-item">
                            <span class="ref-badge impact-high">High</span>
                            <span class="ref-desc">P4 in Todoist - Urgent tasks</span>
                        </div>
                        <div class="reference-item">
                            <span class="ref-badge impact-med">Med</span>
                            <span class="ref-desc">P3 in Todoist - Important tasks</span>
                        </div>
                        <div class="reference-item">
                            <span class="ref-badge impact-low">Low</span>
                            <span class="ref-desc">P2 in Todoist - Normal tasks</span>
                        </div>
                        <div class="reference-item">
                            <span class="ref-badge impact-none">â€”</span>
                            <span class="ref-desc">P1 in Todoist - Low priority</span>
                        </div>
                    </div>
                </div>

                <div class="reference-block">
                    <h3>Clarity Labels</h3>
                    <div class="reference-list">
                        <div class="reference-item">
                            <span class="ref-badge clarity-exec">Exec</span>
                            <span class="ref-label">@executable</span>
                        </div>
                        <div class="reference-item">
                            <span class="ref-badge clarity-def">Def</span>
                            <span class="ref-label">@defined</span>
                        </div>
                        <div class="reference-item">
                            <span class="ref-badge clarity-exp">Exp</span>
                            <span class="ref-label">@exploratory</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="energy-info">
                <h3>Energy Modes</h3>
                <div class="energy-list">
                    <div class="energy-item">
                        <span class="energy-num">1</span>
                        <span class="energy-desc">Zombie - Only executable tasks</span>
                    </div>
                    <div class="energy-item">
                        <span class="energy-num">2</span>
                        <span class="energy-desc">Normal - Executable + defined</span>
                    </div>
                    <div class="energy-item">
                        <span class="energy-num">3</span>
                        <span class="energy-desc">Deep Focus - All tasks visible</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}
