/*
 * Whendoist - Tasks Page Styles
 * Uses unified Mode â†” Clarity token system from app.css
 */

/* =============================================================================
   Energy Selector - In Panel Header (Option B)
   ============================================================================= */

.header-energy {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-left: 16px;
    padding-left: 16px;
    border-left: 1px solid var(--border-subtle);
}

.header-energy__label {
    font-size: 0.5625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
}

.header-energy__pills {
    display: flex;
    gap: 1px;
    background: var(--border-subtle);
    border: 1px solid var(--border-default);
    border-radius: 5px;
    padding: 1px;
}

.header-energy .energy-pill {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 26px;
    height: 20px;
    padding: 0;
    margin: 0 !important; /* Override PICO */
    border: none;
    border-radius: 4px;
    background: var(--bg-surface);
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.12s ease;
}

.header-energy .energy-pill:hover {
    background: var(--bg-panel);
}

.header-energy .energy-pill.active {
    background: var(--primary);
    box-shadow: 0 1px 2px rgba(109, 94, 246, 0.3);
}

/* Dark mode for energy selector */
[data-theme="dark"] .header-energy {
    border-left-color: var(--border-default);
}

[data-theme="dark"] .header-energy__pills {
    background: var(--border-default);
    border-color: var(--border-strong);
}

[data-theme="dark"] .header-energy .energy-pill {
    background: var(--bg-surface);
}

[data-theme="dark"] .header-energy .energy-pill:hover {
    background: var(--bg-panel);
}

[data-theme="dark"] .header-energy .energy-pill.active {
    background: var(--primary);
}

/* =============================================================================
   Layout
   ============================================================================= */

.tasks-layout {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: var(--layout-gap);
    height: calc(100vh - 80px - 1.5rem);
    overflow: hidden;
    align-items: stretch;
    margin-bottom: 1.5rem;
    position: relative;
}

/* Subtle gradient separator between panels */
.tasks-layout::before {
    content: "";
    position: absolute;
    left: calc(66.66% - var(--layout-gap) / 2);
    top: 0;
    bottom: 0;
    width: var(--layout-gap);
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(109, 94, 246, 0.03) 50%,
        transparent 100%
    );
    pointer-events: none;
    z-index: 0;
}

.connection-banner {
    background: var(--impact-medium-tint);
    padding: 0.75rem 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    font-size: 0.875rem;
    border: 1px solid var(--impact-medium);
    color: var(--text-primary);
}

.connection-banner a {
    font-weight: 600;
    color: var(--primary);
}

.connection-banner a:hover {
    color: var(--primary-hover);
}

/* =============================================================================
   Tasks Panel
   ============================================================================= */

.tasks-panel {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: var(--bg-panel);
    border-radius: 12px;
    border: 1px solid var(--border-subtle);
    overflow: hidden;
}

/* =============================================================================
   Calendar Header
   ============================================================================= */

.calendar-header {
    display: grid;
    grid-template-rows: auto 1fr;
    padding: 0.5rem 1rem;
    background: var(--bg-surface);
    border-bottom: 1px solid var(--border-default);
    box-sizing: border-box;
    height: 56px;
}

.calendar-title {
    font-size: 0.6rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    color: var(--text-muted);
    text-align: center;
    line-height: 1;
}

.calendar-actions {
    display: flex;
    gap: 0.5rem;
    align-self: stretch;
    align-items: center;
    justify-content: center;
}

/* =============================================================================
   Task List Container & Header
   ============================================================================= */

.task-list-container {
    position: relative;
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
    padding-top: 0;
    background: var(--bg-panel);
}

.task-list-scroll {
    padding-top: 0;
}

/* Patch 29+43: Task header - grid layout with stronger separation */
.task-list-header {
    position: sticky;
    top: 0;
    z-index: 10;
    display: grid;
    grid-template-columns: 1fr var(--col-duration) var(--col-impact) var(--col-clarity) var(--col-actions);
    column-gap: var(--col-gap);
    align-items: center;
    padding: 8px 0 8px var(--rail-w);
    background: var(--bg-panel);
    border-bottom: 1px solid var(--border-default);
    border-radius: 8px 8px 0 0;
}

/* Patch 43: Calmer header typography */
.header-task {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: 36px;  /* Align with task-content (38px - 2px rail) */
}

.header-task-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: rgba(15, 23, 42, 0.38);  /* Reduced contrast so ENERGY wins */
    line-height: 22px;
}

/* Inline Energy Selector - primary control in header */
.header-energy-inline {
    display: flex;
    align-items: center;
    gap: 8px;
    position: absolute;
    /* Dynamic centering formula */
    right: calc(50% + (var(--col-duration) + var(--col-impact) + var(--col-clarity) + var(--col-actions) + 3 * var(--col-gap) - var(--rail-w) - 40px) / 2);
    top: 50%;
    transform: translate(50%, -50%);
    /* Stronger separation from header */
    border: 1px solid var(--border-strong);
    border-radius: 6px;
    background: rgba(15, 23, 42, 0.045);
    padding: 4px 10px 4px 12px;
    z-index: 5;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}

.energy-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: rgba(15, 23, 42, 0.6);  /* Darker than helper text, matches header typography */
}

.energy-chips {
    display: flex;
    gap: 2px;
}

/* Fixed width chips for stable layout */
.energy-pill-inline {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 22px;
    padding: 0;
    margin: 0;
    border: 1px solid var(--border-subtle);
    border-radius: 4px;
    background: transparent;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.12s ease;
}

.energy-pill-inline:hover {
    background: rgba(15, 23, 42, 0.04);
    border-color: var(--border-default);
}

.energy-pill-inline.active {
    background: var(--primary-tint);
    border-color: rgba(109, 94, 246, 0.35);
}

/* Header Actions Column */
.header-actions {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Header Actions Button (kebab menu) - subtle but discoverable */
.header-actions-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 22px;  /* Match energy chips height */
    padding: 0;
    margin: 0 -10px 0 0;
    border: 1px solid var(--border-default);
    background: rgba(109, 94, 246, 0.04);  /* Slight purple tint */
    border-radius: 4px;
    color: rgba(15, 23, 42, 0.45);
    cursor: pointer;
    transition: all 0.12s ease;
}

.header-actions-btn svg {
    width: 12px;
    height: 12px;
}

.header-actions-btn:hover {
    background: rgba(109, 94, 246, 0.08);
    border-color: var(--border-strong);
    color: rgba(15, 23, 42, 0.7);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
}

.header-actions-btn:focus {
    outline: none;
    border-color: rgba(109, 94, 246, 0.4);
    box-shadow: 0 0 0 2px rgba(109, 94, 246, 0.1);
}

/* Active/open state - purple highlight with strong icon */
.header-actions-btn[aria-expanded="true"] {
    background: var(--primary-tint);
    border-color: rgba(109, 94, 246, 0.4);
    color: var(--primary);
}

/* Task List Options Menu - compact popover */
.task-list-options-menu {
    position: absolute;
    top: calc(100% + 6px);
    right: -4px;
    z-index: 100;
    width: 240px;
    background: var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.04);
    padding: 12px;
}

.task-list-options-menu[hidden] {
    display: none;
}

.options-menu-content {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

/* Option section - groups related settings */
.option-section {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.option-section + .option-section {
    padding-top: 14px;
    border-top: 1px solid var(--border-subtle);
}

/* Suboptions container - matches section gap */
.option-suboptions {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.option-section-header {
    display: flex;
    flex-direction: column;
    gap: 2px;
    margin-bottom: 4px;
}

.option-section-title {
    font-size: 0.5625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: rgba(15, 23, 42, 0.45);  /* Caption style - lighter */
}

.option-section-desc {
    font-size: 0.625rem;
    color: rgba(15, 23, 42, 0.4);
    line-height: 1.35;
    margin-top: 1px;
}

/* Option row: two-column grid */
.option-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    min-height: 24px;
}

.option-label {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-primary);
    white-space: nowrap;
}

/* Toggle Switch - compact */
.option-toggle {
    position: relative;
    width: 32px;
    height: 18px;
    padding: 0;
    margin-bottom: 0;
    border: none;
    background: transparent;
    cursor: pointer;
    flex-shrink: 0;
}

.toggle-track {
    display: block;
    width: 100%;
    height: 100%;
    background: rgba(15, 23, 42, 0.15);
    border-radius: 9px;
    transition: background 0.15s ease;
}

.option-toggle.active .toggle-track {
    background: var(--primary);
}

.toggle-thumb {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 14px;
    height: 14px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.12);
    transition: transform 0.15s ease;
}

.option-toggle.active .toggle-thumb {
    transform: translateX(14px);
}

/* Segmented Control - compact */
.option-segmented {
    display: flex;
    gap: 0;
    border: 1px solid var(--border-default);
    border-radius: 4px;
    overflow: hidden;
    flex-shrink: 0;
}

.seg-btn {
    padding: 4px 8px;
    border: none;
    border-right: 1px solid var(--border-subtle);
    background: var(--bg-surface);
    font-size: 0.625rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.12s ease;
    white-space: nowrap;
}

.seg-btn:last-child {
    border-right: none;
}

.seg-btn:hover {
    background: var(--bg-panel);
    color: var(--text-primary);
}

.seg-btn.active {
    background: var(--bg-panel);
    color: var(--text-primary);
    font-weight: 600;
}

/* Option Menu Divider & Action Button */
.option-divider {
    height: 1px;
    background: var(--border-default);
    margin: 6px 0;
}

.option-action-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    width: 100%;
    padding: 6px 0;
    margin: 0;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 0.6875rem;
    color: var(--text-muted);
    transition: all 0.12s ease;
}

.option-action-btn:hover {
    color: var(--text-primary);
}

.option-action-icon {
    font-size: 0.75rem;
}

/* Deleted Tasks View - Header Elements */
.header-back-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    margin: 0;
    border: 1px solid var(--primary);
    background: var(--primary-tint);
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.6875rem;
    font-weight: 600;
    color: var(--primary);
    transition: all 0.12s ease;
}

.header-back-btn:hover {
    background: var(--primary);
    color: white;
}

.header-back-btn[hidden] {
    display: none;
}

.back-arrow {
    font-size: 0.75rem;
}

.header-view-count {
    font-size: 0.6rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    color: var(--text-muted);
}

.header-view-count[hidden] {
    display: none;
}

.header-task-label[hidden] {
    display: none;
}

.header-energy-inline[hidden] {
    display: none !important;
}

.deleted-group.project-group {
    opacity: 0.85;
}

.deleted-item.task-item {
    background: var(--bg-surface);
    border-left: 2px solid var(--border-default);
}

.deleted-item .task-text {
    text-decoration: none;
    color: var(--text-primary);
}

.deleted-item .task-desc-preview {
    display: block;
    font-size: 0.6875rem;
    color: var(--text-muted);
    opacity: 0.7;
    margin-top: 2px;
}

/* Restore gutter - positioned inside task-content */
.deleted-item .task-content {
    position: relative;
    padding-left: 32px;
}

.deleted-item .task-content .restore-gutter {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    display: grid;
    place-items: center;
    width: 28px;
    height: 28px;
    margin: 0;
    border: 0;
    background: transparent;
    cursor: pointer;
    color: var(--text-muted);
    font-size: 1rem;
    transition: all 0.12s ease;
    padding: 0;
    border-radius: 4px;
}

.deleted-item .task-content .restore-gutter:hover {
    color: var(--impact-low);
    background: rgba(26, 145, 96, 0.1);
}

.restore-icon {
    font-size: 1rem;
}

.deleted-empty {
    padding: 2rem 1rem;
    text-align: center;
}

/* Completed Tasks View - normal styling (keep checkmark) */
.completed-group .task-item {
    opacity: 1 !important;
}

.completed-group .task-item .task-text,
.completed-group .task-item.completed-today .task-text,
.completed-group .task-item.completed-older .task-text {
    text-decoration: none !important;
    color: var(--text-primary) !important;
}

.completed-group .task-item .task-due,
.completed-group .task-item .meta-duration,
.completed-group .task-item .meta-impact,
.completed-group .task-item .meta-clarity {
    color: var(--text-primary) !important;
}

.completed-empty {
    padding: 2rem 1rem;
    text-align: center;
}

/* Patch 29: Header meta - spans grid columns 2-4 */
.header-meta {
    display: contents;  /* Children become direct grid items */
}

.header-label {
    font-size: 0.6rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    color: var(--text-muted);
    text-align: center;
    white-space: nowrap;
}

/* Patch 27: Sortable Header Buttons - calmer, reduced contrast so ENERGY wins */
.header-sort {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0;
    padding: 0;
    margin: 0;
    border: none;
    background: transparent;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: rgba(15, 23, 42, 0.38);  /* Reduced from 0.55 */
    cursor: pointer;
    text-align: center;
    white-space: nowrap;
    transition: color 0.15s ease;
}

.header-sort:hover {
    color: var(--text-primary);
}

/* Bugfix: Active sort - text color only, no border/background */
.header-sort.active {
    color: var(--text-primary);
}

.header-sort .sort-icon {
    font-size: 0.5rem;
    width: 0;
    overflow: hidden;
    opacity: 0;
    transition: opacity 0.15s ease, width 0.15s ease;
}

.header-sort:hover .sort-icon,
.header-sort.active .sort-icon {
    width: auto;
    margin-left: 2px;
    opacity: 1;
}

/* Patch 29: Widths now handled by grid columns */
.header-sort[data-sort="duration"],
.header-sort[data-sort="impact"],
.header-sort[data-sort="clarity"] {
    width: auto;
    justify-content: center;
}

/* =============================================================================
   Project Groups (Foldable)
   ============================================================================= */

/* Patch 33: Tighter vertical rhythm */
.project-group {
    margin-bottom: 0.5rem;
    background: var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: 10px;
    overflow: hidden;
}

.project-group:last-child {
    margin-bottom: 0;
}

.project-group > summary {
    list-style: none;
}

.project-group > summary::-webkit-details-marker {
    display: none;
}

/* Patch 46: Domain header - tighter density */
.project-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 9px 12px 9px 24px;  /* Extra left padding to align with task text */
    margin: 0 !important;
    background: var(--bg-panel);
    cursor: pointer;
    user-select: none;
    transition: background 0.15s ease;
}

.project-header:hover {
    background: var(--dark-bg);
}

.project-header::before {
    content: "\25B6";
    font-size: 0.55rem;
    color: var(--text-muted);
    transition: transform 0.15s ease;
    opacity: 0.6;
}

.project-group[open] .project-header::before {
    transform: rotate(90deg);
}

.project-name {
    flex: 1;
    font-weight: 600;
    font-size: 0.8rem;
    color: var(--text-primary);
}

.task-count {
    font-size: 0.65rem;
    font-weight: 500;
    background: var(--bg-surface);
    color: var(--text-muted);
    padding: 0.125rem 0.4rem;
    border-radius: 8px;
    border: 1px solid var(--border-subtle);
    transition: all 0.15s ease;
}

.task-count.filtered {
    background: var(--primary-tint, #eef2ff);
    color: var(--primary, #6366f1);
}

/* =============================================================================
   Task List & Subtasks
   ============================================================================= */

.task-list {
    display: flex;
    flex-direction: column;
    padding: 0;
    gap: 0;  /* No gap - using dividers instead */
}

/* =============================================================================
   Task Item
   ============================================================================= */

/* Patch 29+46: Task rows - grid layout with increased height for scannability */
.task-item {
    display: grid;
    grid-template-columns: 1fr var(--col-duration) var(--col-impact) var(--col-clarity) var(--col-actions);
    column-gap: var(--col-gap);
    align-items: center;
    padding: 10px 0 10px var(--rail-w);  /* Increased for ~44px row height */
    min-height: 44px;
    background: transparent;
    border: 0;
    border-radius: 0;
    cursor: grab;
    transition: all 0.15s ease;
    position: relative;
}

/* Empty actions cell in task rows - maintains grid alignment */
.task-actions {
    width: var(--col-actions);
}

/* Patch 58: Inset row dividers - starts after rail */
.task-item::after {
    content: "";
    position: absolute;
    left: var(--rail-w);
    right: 0;
    bottom: 0;
    height: 1px;
    background: var(--border-subtle);
    pointer-events: none;
}

/* Patch 21: Impact rail as pseudo-element (no harsh edges) */
.task-item::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: var(--rail-w);
    background: transparent;
    border-radius: 0 2px 2px 0;
}

/* Last task row has no divider (before add-task-row) */
.task-item:last-of-type::after {
    display: none;
}

.task-item:active {
    cursor: grabbing;
}

/* Impact: rail color via pseudo-element, wash is secondary */
.task-item.impact-1 { background: var(--impact-p1-row); }
.task-item.impact-2 { background: var(--impact-p2-row); }
.task-item.impact-3 { background: var(--impact-p3-row); }
.task-item.impact-4 { background: var(--impact-p4-row); }

.task-item.impact-1::before { background: var(--impact-high-border); }
.task-item.impact-2::before { background: var(--impact-medium); }
.task-item.impact-3::before { background: var(--impact-low); }
.task-item.impact-4::before { background: var(--impact-min); }

/* Patch 45: Precision hover with inner glow */
.task-item:hover {
    background: rgba(15, 23, 42, 0.02) !important;
    box-shadow: var(--shadow-inner-glow);
}

/* Meta columns fade - visible only on hover */
.task-item .meta-duration,
.task-item .meta-impact,
.task-item .meta-clarity {
    opacity: 0.5;
    transition: opacity var(--duration-fast) var(--ease-default);
}

.task-item:hover .meta-duration,
.task-item:hover .meta-impact,
.task-item:hover .meta-clarity {
    opacity: 1;
}

/* Rail expands on hover */
.task-item::before {
    transition: width var(--duration-fast) var(--ease-default);
}

.task-item:hover::before {
    width: 3px;
}

/* Selection stays purple */
.task-item.is-selected {
    background: var(--row-active) !important;
}
.task-item.is-selected::before {
    background: var(--primary) !important;
}

/* Keyboard focus */
.task-item:focus-visible {
    outline: 2px solid var(--focus-ring);
    outline-offset: 1px;
}

/* =============================================================================
   Completion Gutter Component
   ============================================================================= */

.complete-gutter {
    width: 22px;
    min-width: 22px;
    height: 100%;
    border: 0;
    background: transparent;
    padding: 0;
    display: grid;
    place-items: center;
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    cursor: pointer;
    z-index: 2;
}

.complete-gutter:focus {
    outline: none;
}

.complete-gutter:focus-visible {
    outline: 2px solid var(--focus-ring);
    outline-offset: -2px;
}

.complete-bar {
    position: absolute;
    left: 8px;
    top: 8px;
    bottom: 8px;
    width: 3px;
    border-radius: 3px;
    background: var(--bar-color, var(--impact-min));
    transition: opacity 120ms ease;
}

.complete-check {
    width: 16px;
    height: 16px;
    border-radius: 8px;
    display: grid;
    place-items: center;
    font-size: 10px;
    font-weight: 800;
    opacity: 0;
    transform: scale(0.9);
    transition: opacity 120ms ease, transform 120ms ease;
    background: rgba(15, 23, 42, 0.06);
    color: var(--text-primary);
    position: relative;
    z-index: 1;
}

/* Impact colors for the bar */
.task-item.impact-1 .complete-bar { background: var(--impact-high-border); }
.task-item.impact-2 .complete-bar { background: var(--impact-medium); }
.task-item.impact-3 .complete-bar { background: var(--impact-low); }
.task-item.impact-4 .complete-bar { background: var(--impact-min); }

/* Hover-only variant (left task list) - no bar, check appears on hover */
.complete-gutter--hover {
    width: 36px;  /* 1.5x wider for easier click target, check centered */
    min-width: 36px;
    left: var(--rail-w);  /* Start after the 2px impact rail */
}

/* Dynamic padding for task items with hover gutter */
.task-item:has(.complete-gutter--hover) {
    padding-left: 38px; /* Aligns task text with domain name (rail + gutter) */
}

.complete-gutter--hover .complete-bar {
    display: none;
}

.complete-gutter--hover .complete-check {
    opacity: 0;
    transform: scale(0.9);
    transition: opacity 0.15s ease, transform 0.15s ease, background 0.15s ease, color 0.15s ease;
}

.task-item:hover .complete-gutter--hover .complete-check,
.task-item:focus-within .complete-gutter--hover .complete-check {
    opacity: 1;
    transform: scale(1);
}

/* Purple hover effect like FAB */
.complete-gutter--hover:hover .complete-check {
    background: rgba(109, 94, 246, 0.12);
    color: var(--primary);
}

/* Completed state - base (purple per brand guidelines) */
.task-item[data-completed="1"] .complete-check {
    opacity: 1;
    transform: scale(1);
    background: rgba(109, 94, 246, 0.15);
    color: var(--primary);
}

.task-item[data-completed="1"] .complete-bar {
    opacity: 0.35;
}

.task-item[data-completed="1"] .task-text {
    text-decoration: line-through;
    color: rgba(15, 23, 42, 0.5);
}

/* Completed task - muted color for all meta elements (no strikethrough) */
.task-item[data-completed="1"] .task-due,
.task-item[data-completed="1"] .meta-duration,
.task-item[data-completed="1"] .meta-impact,
.task-item[data-completed="1"] .meta-clarity {
    color: rgba(15, 23, 42, 0.5);
}

/* Completed task - muted dots */
.task-item[data-completed="1"] .meta-impact::before,
.task-item[data-completed="1"] .meta-clarity::before {
    opacity: 0.4;
}

.task-item[data-completed="1"] {
    opacity: 0.65;
}

/* =============================================================================
   Visual Aging - Completed Task Progressive Fade
   Applied via completion_age_class from backend
   ============================================================================= */

/* Completed tasks - muted grey with strikethrough (overrides .scheduled) */
.task-item.completed .task-text,
.task-item.completed.scheduled .task-text {
    color: rgba(15, 23, 42, 0.5);
    text-decoration: line-through;
}

/* Completed task - consistent muted text (no strikethrough on meta) */
.task-item.completed .task-due,
.task-item.completed .meta-duration,
.task-item.completed .meta-impact,
.task-item.completed .meta-clarity,
.task-item.completed.scheduled .task-due,
.task-item.completed.scheduled .meta-duration,
.task-item.completed.scheduled .meta-impact,
.task-item.completed.scheduled .meta-clarity {
    color: rgba(15, 23, 42, 0.5);
}

/* Completed task - muted dots */
.task-item.completed .meta-impact::before,
.task-item.completed .meta-clarity::before,
.task-item.completed.scheduled .meta-impact::before,
.task-item.completed.scheduled .meta-clarity::before {
    opacity: 0.4;
}

.task-item.completed::before,
.task-item.completed.scheduled::before {
    opacity: 0.5;
}

/* =============================================================================
   Calendar Checkbox + Flush-Left Domain Stripe
   Full-height stripe attached to card edge, checkbox sits just right of it
   ============================================================================= */

/* -----------------------------------------------------------------------------
   Geometry Tokens
   ----------------------------------------------------------------------------- */

:root {
    --cal-rail-w: 2px;            /* Stripe width - matches old style */
    --cal-rail-muted: 0.35;       /* Completed state opacity */
    --cal-check-hit: 24px;        /* Checkbox hit area - fits 30px task with 1px border + 1px padding */
    --cal-check-vis: 16px;        /* Checkbox visible size (smaller, tidier) */
    --cal-action-slot: 36px;      /* Reserved right action column */
}

/* -----------------------------------------------------------------------------
   Domain Stripe - flush left, full height
   ----------------------------------------------------------------------------- */

/* Reserve padding: left for rail, right for checkbox */
/* Top/right/bottom = 1px so 30-min tasks have checkbox centered (equal spacing all sides) */
.scheduled-task.calendar-item {
    padding: 1px 1px 1px calc(var(--cal-rail-w) + 8px);
}

/* The stripe via ::before - flush left, full height */
/* Rail radius inherits card radius for seamless integration */
.scheduled-task.calendar-item::before,
.date-only-task.calendar-item::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: var(--cal-rail-w);
    background: var(--domain-color, var(--impact-min));
    z-index: 0;
    transition: opacity 0.15s ease;
}

/* Timed blocks: 10px radius (matches .scheduled-task border-radius) */
.scheduled-task.calendar-item::before {
    border-top-left-radius: 10px;
    border-bottom-left-radius: 10px;
}

/* Anytime pills: 10px radius (matches .date-only-task border-radius) */
.date-only-task.calendar-item::before {
    border-top-left-radius: 10px;
    border-bottom-left-radius: 10px;
}

/* Completed: stripe quieter */
.scheduled-task.calendar-item[data-completed="1"]::before,
.date-only-task.calendar-item[data-completed="1"]::before {
    opacity: var(--cal-rail-muted);
}

/* Ensure content stacks above stripe */
.scheduled-task.calendar-item > *,
.date-only-task.calendar-item > * {
    position: relative;
    z-index: 1;
}

/* -----------------------------------------------------------------------------
   Domain Color Mappings (fallback via impact classes)
   ----------------------------------------------------------------------------- */

.calendar-item.impact-1 { --domain-color: var(--impact-high-border); }
.calendar-item.impact-2 { --domain-color: var(--impact-medium); }
.calendar-item.impact-3 { --domain-color: var(--impact-low); }
.calendar-item.impact-4 { --domain-color: var(--impact-min); }

/* -----------------------------------------------------------------------------
   Checkbox Gutter - right action slot
   ----------------------------------------------------------------------------- */

/* Calendar items use block layout for text wrapping around checkbox */
.scheduled-task.calendar-item {
    display: block;
}

/* Calendar items: checkbox to top-right with equal spacing */
.scheduled-task.calendar-item .complete-gutter {
    float: right;
    position: relative;
    width: var(--cal-check-hit);
    height: var(--cal-check-hit);
    min-width: var(--cal-check-hit);
    margin: 1px 1px 0 0;  /* 1px top + 1px right for equal spacing from edges */
    border: 0;
    background: transparent;
    padding: 0;
    display: grid;
    place-items: center;
    cursor: pointer;
    z-index: 5;
    border-radius: 5px;
    transition: background 0.15s ease;
}

/* Anytime pills: add padding for absolute checkbox */
.date-only-task.calendar-item {
    padding-right: calc(var(--cal-check-hit) + 8px);
}

/* Anytime pills: checkbox absolutely positioned on right */
.date-only-task.calendar-item .complete-gutter {
    position: absolute;
    top: 0;
    bottom: 0;
    left: auto;
    right: 4px;
    margin: auto 0;
    width: var(--cal-check-hit);
    height: var(--cal-check-hit);
    border: 0;
    background: transparent;
    padding: 0;
    display: grid;
    place-items: center;
    cursor: pointer;
    z-index: 5;
    border-radius: 5px;
    transition: background 0.15s ease;
}

/* Hide checkbox in short duration blocks (< 30m) - too cramped */
.scheduled-task.calendar-item.duration-short .complete-gutter {
    display: none;
}

/* No right padding needed for short blocks without checkbox */
.scheduled-task.calendar-item.duration-short {
    padding-right: 8px;
}

/* Hide the bar element - stripe replaces it */
.calendar-item .complete-gutter .complete-bar {
    display: none;
}

/* Gutter hover feedback */
.calendar-item .complete-gutter:hover {
    background: rgba(15, 23, 42, 0.05);
}

/* -----------------------------------------------------------------------------
   Checkbox Icon - 18px visual, unified states
   ----------------------------------------------------------------------------- */

.calendar-item .complete-check {
    width: var(--cal-check-vis);
    height: var(--cal-check-vis);
    border-radius: 4px;
    font-size: 9px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    /* Override base opacity:0 - always visible in calendar */
    opacity: 1;
    transform: none;
    position: relative;
    z-index: 1;
    /* Incomplete: subtle neutral fill, no heavy shadow */
    background: #FAFBFC;
    border: 1px solid rgba(15, 23, 42, 0.15);
    color: transparent;
    transition:
        transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1),
        background 0.15s ease,
        border-color 0.15s ease,
        color 0.15s ease;
}

/* -----------------------------------------------------------------------------
   Checkbox Hover States
   ----------------------------------------------------------------------------- */

/* Card hover - subtle tint for discoverability */
.calendar-item:hover .complete-check {
    background: #F3F4F6;
    border-color: rgba(15, 23, 42, 0.2);
}

/* Direct checkbox hover - faint tinted background (no purple border) */
.calendar-item .complete-gutter:hover .complete-check {
    background: #E8ECF0;
    border-color: rgba(15, 23, 42, 0.25);
}

/* Focus-visible for accessibility */
.calendar-item .complete-gutter:focus-visible .complete-check {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
}

/* -----------------------------------------------------------------------------
   Completed State - purple tint per brand guidelines (not green)
   ----------------------------------------------------------------------------- */

.calendar-item[data-completed="1"] .complete-check {
    background: rgba(109, 94, 246, 0.12);
    border-color: rgba(109, 94, 246, 0.4);
    color: var(--primary);
}

.calendar-item[data-completed="1"]:hover .complete-check,
.calendar-item[data-completed="1"] .complete-gutter:hover .complete-check {
    background: rgba(109, 94, 246, 0.18);
    border-color: rgba(109, 94, 246, 0.5);
}

/* -----------------------------------------------------------------------------
   Pop Animation - gentle feedback
   ----------------------------------------------------------------------------- */

.calendar-item .complete-check.pop {
    animation: completion-pulse 0.25s ease-out;
}

/* Task list checkbox pop animation */
.task-item .complete-check.pop {
    animation: completion-pulse 0.25s ease-out;
}

@keyframes checkboxPop {
    0% { transform: scale(0.95); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@media (prefers-reduced-motion: reduce) {
    .calendar-item .complete-check.pop,
    .task-item .complete-check.pop {
        animation: none;
    }
}

/* -----------------------------------------------------------------------------
   Completed Card Styling - dim text + rail only, card stays full opacity
   ----------------------------------------------------------------------------- */

/* Card background stays normal for scanability - no opacity reduction */

/* Dim text only */
.calendar-item[data-completed="1"] .scheduled-task-text,
.calendar-item[data-completed="1"] .date-only-task-text {
    text-decoration: line-through;
    color: rgba(15, 23, 42, 0.5);
}

.calendar-item[data-completed="1"] .scheduled-task-time,
.calendar-item[data-completed="1"] .scheduled-task-duration,
.calendar-item[data-completed="1"] .date-only-task-duration {
    color: var(--text-muted);
}

/* Visual aging for calendar items */

/* Completed tasks - muted grey with strikethrough */
.calendar-item.completed .scheduled-task-text,
.calendar-item.completed .date-only-task-text {
    color: rgba(15, 23, 42, 0.5);
    text-decoration: line-through;
}

/* Add task row - small footer by default, expands on hover */
.add-task-row {
    display: flex;
    align-items: center;
    padding: 0 12px;
    padding-left: 38px;  /* Aligns with task text */
    cursor: pointer;
    background: var(--bg-panel);
    height: 16px;
    overflow: hidden;
    transition: height 0.15s ease, padding 0.15s ease;
}

.add-task-text {
    opacity: 0;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-muted);
    transition: opacity 0.15s ease, color 0.15s ease;
}

.project-group:hover .add-task-row {
    height: 28px;
    padding-top: 5px;
    padding-bottom: 5px;
}

.project-group:hover .add-task-text {
    opacity: 1;
}

.add-task-row:hover {
    background: rgba(109, 94, 246, 0.08);
}

.add-task-row:hover .add-task-text {
    color: var(--primary);
}

.task-content {
    flex: 1;
    min-width: 0;
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
    margin-left: 0;  /* Aligns with domain name in header */
}

.task-text {
    font-size: 0.85rem;
    font-weight: 400;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
    min-width: 0;
}

.task-due {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.65rem;
    font-weight: 500;
    color: var(--text-muted);
    white-space: nowrap;
    flex-shrink: 0;
    height: 22px;
    line-height: 22px;
}

.recurring-icon {
    display: inline-flex;
    align-items: center;
    margin-right: 0.125rem;
    font-size: 0.65rem;
    line-height: 1;
}

/* =============================================================================
   Task Metadata Tags (quiet, color via dot only)
   ============================================================================= */

/* Patch 29: Task meta - spans grid columns 2-4 */
.task-meta {
    display: contents;  /* Children become direct grid items */
}

/* Base tag style - transparent, quiet */
.task-meta > span {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 20px;
    text-align: center;
    font-size: 0.65rem;
    font-weight: 500;
    padding: 2px 8px;
    border-radius: 999px;
    line-height: 1;
    background: transparent;
    border: 1px solid transparent;
    color: var(--text-muted);
    transition: all 0.15s ease;
}

/* Patch 54: Column separators - header only, rows clean */
.meta-duration,
.meta-impact,
.meta-clarity {
    position: relative;
    padding-left: 12px;
}

/* Rows lose separators - cleaner look */
.meta-duration::before,
.meta-duration::after,
.meta-impact::after {
    display: none !important;
}

/* Bugfix: Header separators - centered in column gap */
.header-sort {
    position: relative;
}

/* Dividers between header columns removed for visual symmetry */

.task-meta > span:hover {
    background: var(--chip-bg);
    border-color: var(--border-subtle);
}

.task-meta > span:focus-visible {
    outline: 2px solid var(--focus-ring);
    outline-offset: 1px;
}

/* Patch 27: Duration/time columns - tabular nums for clean alignment */
/* Patch 29: Width now handled by grid */
.meta-duration {
    font-variant-numeric: tabular-nums;
    color: rgba(15, 23, 42, 0.60);
    justify-content: center;
}

/* Impact tags - dot indicator */
/* Patch 29: Width now handled by grid */
.meta-impact {
    color: var(--text-primary);
    justify-content: center;
}
.meta-impact::before {
    content: "";
    width: 7px;
    height: 7px;
    border-radius: 999px;
    display: inline-block;
    margin-right: 5px;
    flex-shrink: 0;
}
.meta-impact.impact-1::before { background: var(--impact-high); }
.meta-impact.impact-2::before { background: var(--impact-medium); }
.meta-impact.impact-3::before { background: var(--impact-low); }
.meta-impact.impact-4::before { background: var(--impact-min); }

/* Clarity tags - dot indicator */
/* Patch 29: Width now handled by grid */
.meta-clarity {
    color: var(--text-primary);
    justify-content: center;
}
.meta-clarity::before {
    content: "";
    width: 7px;
    height: 7px;
    border-radius: 999px;
    display: inline-block;
    margin-right: 5px;
    flex-shrink: 0;
}
.meta-clarity.clarity-executable::before { background: var(--executable-color); }
.meta-clarity.clarity-defined::before { background: var(--defined-color); }
.meta-clarity.clarity-exploratory::before { background: var(--exploratory-color); }
.meta-clarity.clarity-none::before { background: var(--text-muted); }

/* =============================================================================
   Energy/Mode-based Task Filtering
   ============================================================================= */

/* Hide tasks without clarity tag (except in Show All mode) */
body:not([data-energy-level="0"]) .task-item[data-clarity="none"],
body:not([data-energy-level="0"]) .task-item[data-clarity=""],
body:not([data-energy-level="0"]) .task-item:not([data-clarity]) {
    display: none;
}

/* Zombie mode: only executable tasks */
body[data-energy-level="1"] .task-item[data-clarity="defined"],
body[data-energy-level="1"] .task-item[data-clarity="exploratory"] {
    display: none;
}

/* Normal mode: executable + defined */
body[data-energy-level="2"] .task-item[data-clarity="exploratory"] {
    display: none;
}

/* Focus mode: all tasks available (except none) */

/* Hide projects with no visible tasks */
.project-group:not(:has(.task-item:not([style*="display: none"]))) {
    display: none;
}

/* Hide projects where all tasks are hidden by energy filter */
body[data-energy-level="1"] .project-group:not(:has(.task-item[data-clarity="executable"])) {
    display: none;
}

body[data-energy-level="2"] .project-group:not(:has(.task-item[data-clarity="executable"], .task-item[data-clarity="defined"])) {
    display: none;
}

body[data-energy-level="3"] .project-group:not(:has(.task-item[data-clarity="executable"], .task-item[data-clarity="defined"], .task-item[data-clarity="exploratory"])) {
    display: none;
}

/* Deleted items bypass energy filter */
body[data-energy-level] .deleted-item.task-item {
    display: grid !important;
}

body[data-energy-level] .deleted-group.project-group {
    display: block !important;
}

/* Scheduled items bypass energy filter */
body[data-energy-level] .scheduled-item.task-item {
    display: grid !important;
}

body[data-energy-level] .scheduled-group.project-group {
    display: block !important;
}

/* =============================================================================
   Calendar Panel
   ============================================================================= */

.calendar-panel {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: var(--bg-panel);
    border-radius: 12px;
    border: 1px solid var(--border-subtle);
    overflow: hidden;
    position: relative;
}

/* Go to Today floating button */
.go-to-today-btn {
    position: absolute;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 20;
    padding: 0.5rem 1.25rem;
    font-size: 0.75rem;
    font-weight: 600;
    background: var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: 20px;
    color: var(--text-primary);
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    transition: all 0.2s ease;
}

.go-to-today-btn:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.go-to-today-btn.hidden {
    opacity: 0;
    pointer-events: none;
}

/* Horizontal carousel container */
.calendar-carousel {
    display: flex;
    flex-direction: row;
    gap: 0;
    flex: 1;
    min-height: 0;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.calendar-carousel::-webkit-scrollbar {
    display: none;
}

.day-calendar {
    flex: 0 0 100%;
    display: flex;
    flex-direction: column;
    height: 100%;
    background: var(--bg-surface);
    overflow: hidden;
    scroll-snap-align: start;
    scroll-snap-stop: always;
}

/* Past days: slightly dimmed */
.day-calendar.past {
    opacity: 0.7;
}

/* Today: full prominence with subtle purple tint */
.day-calendar.today {
    opacity: 1;
    background: rgba(109, 94, 246, 0.02);
}

/* Future days: slightly dimmed */
.day-calendar.future {
    opacity: 0.85;
}

/* Calendar actions - center the button horizontally */
.calendar-actions {
    justify-content: center;
}

.calendar-action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.25rem;
    margin: 0;
    padding: 0.25rem 0.5rem;
    border: 1px solid var(--border-default);
    border-radius: 6px;
    background: transparent;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--text-muted);
    font-family: inherit;
    font-size: inherit;
    height: 26px;
    box-sizing: border-box;
}

.calendar-action-btn:hover {
    border-color: var(--exploratory-color);
    color: var(--exploratory-color);
}

.calendar-action-btn.active {
    border-color: var(--exploratory-color);
    color: var(--exploratory-color);
    box-shadow: 0 0 8px rgba(138, 24, 160, 0.3);
}

.action-emoji {
    font-size: 0.875rem;
    line-height: 1;
}

.action-name {
    font-size: 0.6rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

/* All Day Events */
.all-day-section {
    padding: 0.5rem;
    background: var(--bg-panel);
    border-bottom: 1px solid var(--border-subtle);
}

.all-day-section:empty,
.all-day-section:not(:has(.all-day-event)) {
    display: none;
}

.all-day-event {
    background: var(--defined-tint);
    border: 1px solid var(--defined-color);
    border-left: 3px solid var(--defined-color);
    border-radius: 4px;
    padding: 0.375rem 0.5rem;
    font-size: 0.75rem;
    color: var(--text-primary);
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.all-day-event:last-child {
    margin-bottom: 0;
}

/* =============================================================================
   Day Header (date and Plan button)
   ============================================================================= */

.day-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0 2rem;
    height: 35.5px;
    background: var(--bg-panel);
    border-bottom: 1px solid var(--border-subtle);
    line-height: 1;
    box-sizing: border-box;
}

.day-header-date {
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    line-height: 1;
}

/* Patch 50: Plan button - chip style, not pill */
.plan-day-btn {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.625rem;
    margin: 0;
    background: rgba(109, 94, 246, 0.08);
    border: 1px solid rgba(109, 94, 246, 0.14);
    border-radius: 8px;
    color: #4C3EF0;
    font-size: 0.65rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    line-height: 1;
    box-shadow: none;
}

.plan-day-btn:hover {
    background: rgba(109, 94, 246, 0.12);
    border-color: rgba(109, 94, 246, 0.18);
}

/* Active state (Plan mode on) */
.plan-day-btn.active {
    background: rgba(201, 80, 90, 0.08);
    color: var(--impact-high);
    border-color: rgba(201, 80, 90, 0.18);
}

.plan-day-btn.active:hover {
    background: rgba(201, 80, 90, 0.12);
    border-color: rgba(201, 80, 90, 0.22);
}

.plan-day-btn .action-emoji {
    font-size: 0.8rem;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

.plan-day-btn .action-name {
    text-transform: uppercase;
    letter-spacing: 0.05em;
    line-height: 1;
}

/* =============================================================================
   Date-Only Tasks Banner (tasks with date but no time)
   ============================================================================= */

/* Patch 57: Anytime lane - tray style */
/* Fixed height prevents alignment shift between days with different task counts */
.date-only-banner {
    display: flex;
    align-items: flex-start;
    height: 72px;
    background: rgba(15, 23, 42, 0.02);
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    margin: 4px;
}

.date-only-label {
    width: 48px;
    flex-shrink: 0;
    padding: 0.375rem 0.5rem;
    font-size: 0.5rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    color: var(--text-muted);
    text-align: right;
    white-space: nowrap;
    opacity: 0.7;
    height: 100%;
    display: flex;
    align-items: flex-start;
    justify-content: flex-end;
    padding-top: 0.5rem;
}

.date-only-tasks {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    gap: 0.125rem;
    padding: 0.25rem 0.5rem 0.25rem 0;
    height: 100%;
    align-items: flex-start;
    align-content: flex-start;
    overflow-y: auto;
    overflow-x: hidden;
}

/* Subtle scrollbar for anytime tasks */
.date-only-tasks::-webkit-scrollbar {
    width: 4px;
}

.date-only-tasks::-webkit-scrollbar-track {
    background: transparent;
}

.date-only-tasks::-webkit-scrollbar-thumb {
    background: var(--border-default);
    border-radius: 2px;
}

/* Drop target styling - subtle highlight on entire banner */
.date-only-banner.drag-over,
.date-only-banner.drop-hint {
    background: var(--drop-bg);
    border-bottom-color: var(--drop-border);
}

/* Patch 24+57: Anytime pills - white cards in tray */
.date-only-task {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.25rem 0.625rem;
    padding-left: calc(0.625rem + var(--rail-w));
    background: rgba(255, 255, 255, 0.92);
    border: 1px solid var(--border-subtle);
    border-radius: 10px;
    font-size: 0.7rem;
    color: var(--text-primary);
    cursor: grab;
    transition: all 0.15s ease;
    width: calc(100% - 0.5rem);
    flex-shrink: 0;
    overflow: hidden;
    position: relative;
}

/* Patch 21: Impact rail as pseudo-element */
.date-only-task::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: var(--rail-w);
    background: transparent;
    border-radius: 10px 0 0 10px;
}

.date-only-task:hover {
    background: rgba(109, 94, 246, 0.05);
    border-color: rgba(109, 94, 246, 0.16);
}

.date-only-task:active {
    cursor: grabbing;
    transform: translateY(0);
}

.date-only-task.dragging {
    opacity: 0.4;
}

.date-only-task-text {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    flex: 1;
    min-width: 0;
    font-weight: 450;
}

.date-only-task-duration {
    width: 26px;
    flex-shrink: 0;
    font-size: 0.6rem;
    color: var(--text-muted);
    white-space: nowrap;
    opacity: 0.7;
}

/* Patch 57: Impact via rail only - white cards in tray */
.date-only-task.impact-1,
.date-only-task.impact-2,
.date-only-task.impact-3,
.date-only-task.impact-4 { background: rgba(255, 255, 255, 0.92); }

.date-only-task.impact-1::before { background: var(--impact-high-border); }
.date-only-task.impact-2::before { background: var(--impact-medium); }
.date-only-task.impact-3::before { background: var(--impact-low); }
.date-only-task.impact-4::before { background: var(--impact-min); }

/* Mobile responsive */
@media (max-width: 900px) {
    .date-only-banner {
        min-height: 40px;
    }

    .date-only-label {
        width: 40px;
        padding: 0.25rem 0.375rem;
        font-size: 0.55rem;
    }

    .date-only-tasks {
        min-height: 40px;
        padding: 0.125rem 0.25rem 0.125rem 0;
    }

    .date-only-tasks:empty {
        min-height: 40px;
    }

    .date-only-task {
        padding: 0.125rem 0.375rem;
        font-size: 0.6rem;
    }

    .date-only-task-duration {
        font-size: 0.5rem;
    }

    .day-header {
        padding: 0.5rem 0.5rem 0.375rem 0.5rem;
    }

    .day-header-date {
        font-size: 0.6rem;
    }

    .plan-day-btn .action-emoji {
        font-size: 0.6rem;
    }

    .plan-day-btn .action-name {
        font-size: 0.5rem;
    }
}

/* Hour Grid */
.hour-grid {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    position: relative;  /* For time selection overlay positioning */
    background: var(--bg-surface);
    isolation: isolate;  /* Create stacking context so task z-index works across rows */
    /* Hide scrollbar while keeping scroll functionality */
    scrollbar-width: none;  /* Firefox */
    -ms-overflow-style: none;  /* IE/Edge */
}

.hour-grid::-webkit-scrollbar {
    display: none;  /* Chrome/Safari/Opera */
}

.hour-grid.collapsed {
    /* No longer collapsed - same scrolling behavior */
}

/* Patch 55: Hour rows - major hour lines for scan aid */
.hour-row {
    display: flex;
    border-bottom: 1px solid rgba(15, 23, 42, 0.05);
    min-height: 60px;
    background: transparent;
    overflow: visible; /* Allow tasks to extend beyond row */
}

/* Patch 47+55: Alternate banding + stronger lines every 2nd hour */
.hour-row:nth-child(even) {
    background: rgba(15, 23, 42, 0.015);
}

.hour-row:nth-child(2n) {
    border-bottom-color: rgba(15, 23, 42, 0.075);
}

.hour-row:nth-child(odd) {
    background: transparent;
}

.hour-row:last-child {
    border-bottom: none;
}

/* Patch 56: Hour labels - instrument-like gutter, reduced opacity for less noise */
.hour-label {
    width: 54px;
    flex-shrink: 0;
    padding: 0.375rem 10px 0.375rem 0;
    font-size: 0.65rem;
    font-weight: 500;
    font-variant-numeric: tabular-nums;
    color: rgba(15, 23, 42, 0.4);
    text-align: right;
}

.hour-row:hover .hour-label {
    color: rgba(15, 23, 42, 0.58);
}

/* Patch 56: Hour slot with breathing room after labels */
/* Bugfix: min-width: 0 prevents flex from expanding with long task text */
.hour-slot {
    flex: 1;
    min-width: 0;
    padding: 0.25rem 0.5rem 0.25rem 6px;
    min-height: 60px;
    position: relative;
    overflow: visible;
}

.hour-slot[data-droppable="true"] {
    transition: background 0.15s ease;
}

.hour-slot[data-droppable="true"]:hover {
    background: color-mix(in srgb, var(--primary) 5%, transparent);
}

/* Adjacent day hours (previous evening / next morning) */
.hour-row.adjacent-day {
    background: var(--bg-panel);
    box-shadow: inset 0 0 0 1px var(--border-subtle);
}

.hour-row.adjacent-day .hour-label {
    font-style: italic;
    opacity: 0.7;
}

.hour-row.adjacent-day .hour-slot {
    background: var(--bg-panel);
}

.hour-row.adjacent-day:hover {
    opacity: 0.9;
}

/* Patch 51: Day separator - line + pill label (not a slab) */
/* Bugfix: negative margin so tasks can span across without gap */
.day-separator {
    display: grid;
    place-items: center;
    height: 34px;
    margin-top: -17px;
    margin-bottom: -17px;
    background: transparent !important;
    position: relative;
    z-index: 15;
    pointer-events: none;
}

/* Horizontal line */
.day-separator::before {
    content: "";
    position: absolute;
    left: 18px;
    right: 18px;
    top: 50%;
    height: 1px;
    background: rgba(15, 23, 42, 0.08);
    transform: translateY(-50%);
}

/* Pill label */
.day-separator-label {
    position: relative;
    z-index: 1;
    padding: 4px 10px;
    border-radius: 999px;
    background: var(--bg-surface);
    border: 1px solid rgba(15, 23, 42, 0.06);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.10em;
    color: rgba(15, 23, 42, 0.42);
    text-transform: uppercase;
    pointer-events: auto;
}

.day-separator.day-start,
.day-separator.day-end {
    position: static;
    height: 34px;
}

.day-separator.day-start .day-separator-label,
.day-separator.day-end .day-separator-label {
    background: var(--bg-panel);
}

/* Patch 22: Now indicator - thicker with subtle glow */
.now-line {
    position: absolute;
    left: 50px; /* Width of hour label */
    right: 0;
    height: 2px;
    background: var(--now);
    z-index: 50;
    pointer-events: none;
    box-shadow: 0 0 8px rgba(var(--now), 0.4);
}

.now-line::before {
    content: '';
    position: absolute;
    left: -5px;
    top: -4px;
    width: 10px;
    height: 10px;
    background: var(--now-dot);
    border-radius: 999px;
    box-shadow: 0 2px 6px rgba(15, 23, 42, 0.18), 0 0 12px rgba(109, 94, 246, 0.3);
}

/* Patch 23: Calendar events - subtle gradient, rounded corners */
.calendar-event {
    display: flex;
    align-items: flex-start;
    gap: 4px;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.05) 0%, transparent 5%), var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: 6px;
    padding: 3px 0.5rem;
    padding-left: calc(0.5rem + var(--rail-w));
    font-size: 0.65rem;
    line-height: 1.2;
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    z-index: 4;
    overflow: hidden;
    box-sizing: border-box;
}

/* Calendar event rail */
.calendar-event::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: var(--rail-w);
    background: var(--text-muted);
    border-radius: 6px 0 0 6px;
}

.event-left {
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    width: 32px;
}

/* Event meta - matches scheduled-task styling */
.event-time {
    font-weight: 600;
    color: var(--text-muted);
}

.event-duration {
    color: var(--text-muted);
}

/* Event title - matches scheduled-task-text styling */
.event-title {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    color: var(--text-primary);
    line-height: 1.2;
    word-break: break-word;
}

/* Duration-based line clamping for calendar events */
.calendar-event.duration-short .event-title {
    -webkit-line-clamp: 1;
}

.calendar-event.duration-medium .event-title {
    -webkit-line-clamp: 2;
}

.calendar-event.duration-long .event-title {
    -webkit-line-clamp: unset;
}

/* =============================================================================
   All-day Events (neutral grey like calendar events)
   ============================================================================= */

.all-day-event {
    background: var(--bg-panel);
    border: 1px solid var(--border-subtle);
    border-left: 3px solid var(--text-muted);
}

/* =============================================================================
   Drag and Drop
   ============================================================================= */

/* Patch 19: Disable row wash during drag to reduce visual noise */
body.is-dragging .task-item:not(.dragging) {
    background: transparent !important;
}

/* Freeze hover/selection during drag (prevents flicker) */
body.is-dragging .task-item:not(.dragging):hover,
body.is-dragging .date-only-task:hover,
body.is-dragging .scheduled-task:hover {
    background: transparent !important;
    border-color: inherit;
}

body.is-dragging .task-item.is-selected:not(.dragging) {
    background: transparent !important;
}

/* Patch 15: Calendar drag - only affect existing events, not newly created ones */
/* Use .dragging class to identify the actual dragged element */
body.is-dragging .scheduled-task.dragging,
body.is-dragging .calendar-event {
    pointer-events: none;
}

/* Patch 37: Single ghost preview - reduced purple, no inner boxing */
.drop-indicator {
    background: var(--ghost-bg) !important;
    border: 1px solid var(--ghost-border) !important;
    border-radius: 10px;
    box-shadow: none !important;
    z-index: 50;
}

/* Kill any extra inner outlines / dashed artifacts */
.drop-indicator * {
    outline: none !important;
    box-shadow: none !important;
}

/* Time label inside ghost - neutral, not purple */
.drop-indicator {
    color: rgba(15, 23, 42, 0.55) !important;
    font-weight: 600;
}

/* Ensure scheduled tasks are visible and positioned correctly */
.scheduled-task,
.calendar-event {
    z-index: 10;
    visibility: visible;
}

/* Task being dragged */
.task-item.dragging {
    opacity: 0.5;
    transform: scale(0.98);
    background: var(--dark-bg);
}

/* Task that has been scheduled - greyed out but still readable */
.task-item.scheduled {
    opacity: 1;
    border-bottom-style: dashed;
}

/* Scheduled task - consistent muted text color for all elements */
.task-item.scheduled .task-text,
.task-item.scheduled .task-due,
.task-item.scheduled .meta-duration,
.task-item.scheduled .meta-impact,
.task-item.scheduled .meta-clarity {
    color: var(--text-muted);
}

/* Scheduled task - muted dots */
.task-item.scheduled .meta-impact::before,
.task-item.scheduled .meta-clarity::before {
    opacity: 0.5;
}

/* Scheduled task rail - muted */
.task-item.scheduled::before {
    opacity: 0.4;
}

/* Completed+scheduled tasks - completed styling wins over .scheduled */
.task-item.completed.scheduled,
.task-item.scheduled[data-completed="1"] {
    opacity: 0.65;
}

.task-item.completed.scheduled .task-text {
    color: rgba(15, 23, 42, 0.5) !important;
    text-decoration: line-through !important;
}

/* Completed+scheduled - muted text (no strikethrough on meta) */
.task-item.completed.scheduled .task-due,
.task-item.completed.scheduled .meta-duration,
.task-item.completed.scheduled .meta-impact,
.task-item.completed.scheduled .meta-clarity {
    color: rgba(15, 23, 42, 0.5) !important;
}

/* Completed+scheduled - muted dots */
.task-item.completed.scheduled .meta-impact::before,
.task-item.completed.scheduled .meta-clarity::before {
    opacity: 0.4 !important;
}

.task-item.completed.scheduled::before {
    opacity: 0.5 !important;
}

/* Patch 16+38: Drop target underlay via pseudo-element (no inner dashed lines) */
.hour-slot.drag-over {
    border: 0 !important;
    outline: 0 !important;
    background: transparent !important;
}

.hour-slot.drag-over::before {
    content: "";
    position: absolute;
    inset: 6px;
    border-radius: 10px;
    background: rgba(109, 94, 246, 0.04);
    outline: 2px solid rgba(109, 94, 246, 0.14);
    outline-offset: -2px;
    z-index: 1;
    pointer-events: none;
}

/* Events always above slot highlight and subsequent hour rows */
/* Bugfix: keep position absolute, use high z-index to render above later hour-row backgrounds */
.hour-slot .scheduled-task,
.hour-slot .calendar-event {
    z-index: 100;
}

/* Scheduled task on calendar */
/* Calendar events reuse same grammar as task rows: rail + subtle wash + gradient */
.scheduled-task {
    display: flex;
    align-items: flex-start;
    gap: 2px;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.05) 0%, transparent 5%), var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: 6px;
    padding: 2px 0.5rem;
    padding-left: calc(0.5rem + var(--rail-w));
    font-size: 0.65rem;
    line-height: 1.2;
    cursor: grab;
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    overflow: hidden;
    box-sizing: border-box;
    transition: transform var(--duration-fast) var(--ease-default),
                box-shadow var(--duration-fast) var(--ease-default);
    /* z-index set in drag section */
}

/* Patch 21: Impact rail as pseudo-element */
.scheduled-task::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: var(--rail-w);
    background: transparent;
    border-radius: 6px 0 0 6px;
}

.scheduled-task:hover {
    background: var(--row-hover) !important;
}

.scheduled-task:active {
    cursor: grabbing;
}

.scheduled-task.dragging {
    opacity: 0.9;
    transform: scale(1.02);
    box-shadow: var(--shadow-drag);
}

/* Scheduled tasks from DB are clickable to edit */
.scheduled-task.from-db {
    cursor: pointer;
}

.scheduled-task-left {
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    width: 32px;
}

/* Calendar: time/duration stacked vertically before text */
.scheduled-task.calendar-item .scheduled-task-left {
    float: left;
    display: flex;
    flex-direction: column;
    width: auto;
    margin-right: 6px;
    line-height: 1.1;
}

.scheduled-task.calendar-item .scheduled-task-left::after {
    content: none;
}

.scheduled-task-time {
    font-weight: 600;
    color: var(--text-muted);
}

.scheduled-task-duration {
    color: var(--text-muted);
}

.scheduled-task-text {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    color: var(--text-primary);
    line-height: 1.2;
    word-break: break-word;
}

/* Calendar: text flows inline, wraps around floated checkbox */
.scheduled-task.calendar-item .scheduled-task-text {
    display: inline;
    -webkit-box-orient: unset;
    -webkit-line-clamp: unset;
}

/* Duration-based line clamping */
.scheduled-task.duration-short .scheduled-task-text {
    -webkit-line-clamp: 1;
}

.scheduled-task.duration-medium .scheduled-task-text {
    -webkit-line-clamp: 2;
}

.scheduled-task.duration-long .scheduled-task-text {
    -webkit-line-clamp: unset;
}

/* Occurrence day indicator for recurring task instances (inline with text) */
.occurrence-day {
    font-size: inherit;
    color: var(--text-muted);
    margin-left: 0.25rem;
    white-space: nowrap;
}

.occurrence-day::before {
    content: 'Â· ';
}

/* Impact: rail color via pseudo-element, wash is secondary */
.scheduled-task.impact-1 { background: var(--impact-p1-row); }
.scheduled-task.impact-2 { background: var(--impact-p2-row); }
.scheduled-task.impact-3 { background: var(--impact-p3-row); }
.scheduled-task.impact-4 { background: var(--impact-p4-row); }

.scheduled-task.impact-1::before { background: var(--impact-high-border); }
.scheduled-task.impact-2::before { background: var(--impact-medium); }
.scheduled-task.impact-3::before { background: var(--impact-low); }
.scheduled-task.impact-4::before { background: var(--impact-min); }

/* Drop indicator / ghost event (reschedule preview) - base positioning */
.drop-indicator {
    position: absolute;
    left: 0;
    right: 0;
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
    padding: 0.2rem 0.4rem;
    font-size: 0.65rem;
    font-weight: 600;
    color: rgba(15, 23, 42, 0.65);
    pointer-events: none;
    box-sizing: border-box;
    overflow: hidden;
    /* Note: ghost styling (bg, border, z-index) set in drag section */
}

/* =============================================================================
   Patch 35+36: Custom Drag Overlay Styling
   ============================================================================= */

/* Generic drag overlay root (for custom drag implementations) */
.drag-overlay,
.drag-ghost {
    max-width: 420px;
    width: max-content;
    pointer-events: none;
    z-index: 9999;
}

/* Force compact layout inside the ghost */
.drag-overlay .task-item,
.drag-ghost .task-item {
    display: flex !important;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    background: var(--bg-surface);
    border: 1px solid var(--border-strong);
    border-radius: 10px;
    box-shadow: 0 12px 28px rgba(15, 23, 42, 0.16);
    overflow: hidden;
}

/* Hide table columns in ghost (prevents spanning into calendar) */
.drag-overlay .meta-duration,
.drag-overlay .meta-impact,
.drag-overlay .meta-clarity,
.drag-ghost .meta-duration,
.drag-ghost .meta-impact,
.drag-ghost .meta-clarity {
    display: none !important;
}

/* Patch 36: When hovering calendar - drag ghost becomes "event pill" */
body.over-calendar .drag-overlay .task-item,
body.over-calendar .drag-ghost .task-item {
    max-width: 320px;
    border-radius: 10px;
    box-shadow: 0 10px 24px rgba(15, 23, 42, 0.14);
    background: rgba(255, 255, 255, 0.94);
}

/* Keep only title visible, stronger */
body.over-calendar .drag-overlay .task-text,
body.over-calendar .drag-ghost .task-text {
    font-weight: 700;
    color: var(--text-primary);
}

/* =============================================================================
   Empty State & Responsive
   ============================================================================= */

.empty-state {
    text-align: center;
    padding: 3rem 1.5rem;
    color: var(--text-muted);
}

.empty-state p {
    margin: 0.25rem 0;
}

@media (max-width: 900px) {
    .tasks-layout {
        grid-template-columns: 1fr;
        grid-template-rows: 3fr 2fr;  /* Tasks slightly larger */
        height: calc(100vh - 40px - 1rem - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
        gap: 0.25rem;
        padding: 0 0.125rem;
        margin-bottom: 1rem;
    }

    .tasks-panel {
        width: 100%;
        border-radius: 6px;
    }

    .calendar-panel {
        width: 100%;
        border-radius: 6px;
    }

    /* Compact calendar header */
    .calendar-header {
        padding: 0.25rem 0.375rem;
        gap: 0.125rem;
    }

    .calendar-title {
        font-size: 0.5rem;
    }

    .calendar-action-btn {
        padding: 0.25rem 0.375rem;
        gap: 0.25rem;
    }

    .action-emoji {
        font-size: 0.875rem;
    }

    .action-name {
        font-size: 0.5rem;
    }

    /* Smaller hour rows for mobile */
    .hour-row {
        min-height: 40px;
    }

    .hour-label {
        width: 40px;
        padding: 0.25rem 0.375rem;
        font-size: 0.55rem;
    }

    .hour-slot {
        min-height: 40px;
        padding: 0.125rem 0.25rem;
    }

    /* Compact task list */
    .task-list-container {
        padding: 0.25rem;
        padding-top: 0;
    }

    .task-list-header {
        padding: 0.25rem 0.25rem 0.125rem 0.25rem;
    }

    .header-sort {
        font-size: 0.5rem;
    }

    /* Patch 29: Mobile grid - smaller columns */
    .task-list-header,
    .task-item {
        grid-template-columns: 1fr 44px 40px 56px 24px;
        column-gap: 6px;
    }

    /* Hide inline energy selector on tablet */
    .header-energy-inline {
        display: none;
    }

    .task-list-scroll {
        padding-top: 0;
    }

    /* Compact project groups */
    .project-group {
        margin-bottom: 0.25rem;
        border-radius: 6px;
    }

    .project-header {
        padding: 0.25rem 0.375rem;
        gap: 0.25rem;
    }

    .project-name {
        font-size: 0.7rem;
    }

    .task-count {
        font-size: 0.55rem;
        padding: 0.0625rem 0.25rem;
    }

    /* Compact task items */
    .task-list {
        padding: 0.125rem;
        gap: 0.125rem;
    }

    .task-item {
        padding: 0.25rem 0.25rem;
        gap: 0.25rem;
        border-radius: 4px;
    }

    .task-content {
        gap: 0.25rem;
    }

    .task-text {
        font-size: 0.75rem;
    }

    .task-due {
        font-size: 0.55rem;
    }

    .task-meta {
        gap: 0.125rem;
    }

    .task-meta > span {
        height: 16px;
        font-size: 0.55rem;
        padding: 0 0.25rem;
    }

    /* Plan helper tooltip */
    .plan-helper {
        top: 3rem;
        right: 0.375rem;
        font-size: 0.55rem;
        padding: 0.375rem 0.5rem;
    }

    /* Scheduled tasks and events - smaller on mobile */
    .calendar-event,
    .scheduled-task {
        font-size: 0.55rem;
        padding: 1px 0.25rem;
    }

    .event-left,
    .scheduled-task-left {
        width: 32px;
        white-space: nowrap;
    }

    .event-time,
    .scheduled-task-time {
        white-space: nowrap;
    }
}

/* Compact labels for narrow screens (< 580px) */
@media (max-width: 580px) {
    /* Patch 29: Narrower grid columns for very small screens */
    .task-list-header,
    .task-item {
        grid-template-columns: 1fr 32px 28px 44px 20px;
        column-gap: 4px;
    }

    /* Smaller options button on phone */
    .header-actions-btn {
        font-size: 14px;
    }

    /* Hide column separators on narrow screens */
    .meta-duration::before,
    .meta-duration::after,
    .meta-impact::after,
    .header-sort[data-sort="duration"]::before,
    .header-sort[data-sort="duration"]::after,
    .header-sort[data-sort="impact"]::after {
        display: none;
    }

    /* Headers: hide text, show abbreviations */
    .header-duration,
    .header-impact,
    .header-clarity {
        color: transparent;
        position: relative;
    }
    .header-duration::after,
    .header-impact::after,
    .header-clarity::after {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        color: var(--text-muted);
    }
    .header-duration::after { content: 'DUR'; }
    .header-impact::after { content: 'IMPCT'; }
    .header-clarity::after { content: 'CLRT'; }

    /* Impact: hide text, show abbreviations */
    .task-meta > span.meta-impact {
        font-size: 0;
        position: relative;
    }
    .task-meta > span.meta-impact::after {
        font-size: 0.6rem;
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .task-meta > span.meta-impact.impact-1::after { content: 'High'; color: var(--impact-high); }
    .task-meta > span.meta-impact.impact-2::after { content: 'Mid'; color: var(--impact-medium); }
    .task-meta > span.meta-impact.impact-3::after { content: 'Low'; color: #157A4E; }
    .task-meta > span.meta-impact.impact-4::after { content: 'Min'; color: var(--impact-min); }

    /* Clarity: hide text, show abbreviations */
    .task-meta > span.meta-clarity {
        font-size: 0;
        position: relative;
    }
    .task-meta > span.meta-clarity::after {
        font-size: 0.6rem;
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .task-meta > span.meta-clarity.clarity-executable::after { content: 'Exec'; color: var(--executable-color); }
    .task-meta > span.meta-clarity.clarity-defined::after { content: 'Def'; color: var(--defined-color); }
    .task-meta > span.meta-clarity.clarity-exploratory::after { content: 'Xplr'; color: #8A18A0; }
    .task-meta > span.meta-clarity.clarity-none::after { content: 'â€”'; color: var(--text-muted); }
}

/* =============================================================================
   Plan Mode Helper Tooltip
   ============================================================================= */

/* Plan helper tooltip - appears below header when plan mode active */
.plan-helper {
    position: absolute;
    top: 3.5rem;
    right: 0.75rem;
    z-index: 20;
    padding: 0.5rem 0.75rem;
    font-size: 0.7rem;
    font-weight: 500;
    color: var(--text-muted);
    background: var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    white-space: nowrap;
}

/* Selection mode active */
.day-calendar.selection-mode .hour-grid {
    cursor: crosshair;
    box-shadow: inset 0 0 30px rgba(138, 24, 160, 0.15);
}

/* =============================================================================
   Time Range Selection (Plan Tasks)
   ============================================================================= */

.time-selection-overlay {
    position: absolute;
    left: 50px;  /* After hour label */
    right: 0;
    background: var(--exploratory-tint);
    border: 2px dashed var(--exploratory-color);
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 0.5rem;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--exploratory-color);
    z-index: 15;
    pointer-events: auto;
    box-sizing: border-box;
}

.time-selection-range {
    margin-bottom: 0.25rem;
}

/* Second overlay for cross-day selections */
.time-selection-overlay-2 {
    position: absolute;
    left: 50px;
    right: 0;
    background: var(--exploratory-tint);
    border: 2px dashed var(--exploratory-color);
    border-radius: 4px;
    z-index: 15;
    pointer-events: none;
    box-sizing: border-box;
}

.plan-tasks-btn {
    padding: 0.5rem 1rem;
    background: var(--exploratory-color);
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition: all 0.15s ease;
    margin-top: auto;
}

.plan-tasks-btn:hover {
    filter: brightness(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* =============================================================================
   CMPCT Mode - Mobile Responsive (<768px)
   ============================================================================= */

/* Default: hide compact labels */
.label-compact {
    display: none;
}

.label-full {
    display: inline;
}

/* Mobile: swap label visibility */
@media (max-width: 767px) {
    .label-full {
        display: none;
    }

    .label-compact {
        display: inline;
    }

    /* Touch-friendly tap targets (min 44px) */
    .task-item {
        min-height: 44px;
    }

    .commit-action-btn {
        min-height: 44px;
        padding: 0.75rem 1rem;
    }

    /* Project/Domain headers */
    .project-header {
        min-height: 44px;
        padding: 0.75rem 1rem;
    }

    /* Add task FAB - larger on mobile */
    .add-task-btn {
        width: 60px;
        height: 60px;
        font-size: 2rem;
    }

    /* Hamburger menu toggle (shown via base.html) */
    .hamburger-toggle {
        display: flex;
    }

    /* Empty state */
    .empty-state kbd {
        padding: 0.25rem 0.5rem;
        background: var(--bg-secondary, #f3f4f6);
        border-radius: 4px;
        font-family: inherit;
    }
}

/* Desktop: hide hamburger */
@media (min-width: 768px) {
    .hamburger-toggle {
        display: none;
    }
}

/* =============================================================================
   Hamburger Menu
   ============================================================================= */

.hamburger-toggle {
    display: none;
    flex-direction: column;
    justify-content: center;
    gap: 4px;
    width: 44px;
    height: 44px;
    padding: 10px;
    background: none;
    border: none;
    cursor: pointer;
    z-index: 101;
}

.hamburger-toggle span {
    display: block;
    width: 24px;
    height: 2px;
    background: var(--text, #1f2937);
    border-radius: 1px;
    transition: all 0.2s ease;
}

.hamburger-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(4px, 4px);
}

.hamburger-toggle.active span:nth-child(2) {
    opacity: 0;
}

.hamburger-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(4px, -4px);
}

/* Mobile Navigation Drawer */
.mobile-nav {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--surface, #fff);
    z-index: 100;
    padding: 80px 24px 24px;
    flex-direction: column;
    gap: 8px;
}

.mobile-nav.open {
    display: flex;
}

.mobile-nav a {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    font-size: 1.125rem;
    color: var(--text, #1f2937);
    text-decoration: none;
    border-radius: 8px;
    transition: background 0.15s;
}

.mobile-nav a:hover {
    background: var(--bg-hover, #f3f4f6);
}

.mobile-nav a.active {
    background: var(--primary-tint, #eef2ff);
    color: var(--primary, #6366f1);
}

/* =============================================================================
   Trash Bin (for drag-to-delete)
   ============================================================================= */

/* Patch 17+39: Trash zone - icon-only until hover/over */
.trash-bin {
    position: fixed;
    left: 50%;
    bottom: 18px;
    transform: translateX(-50%) translateY(10px);
    opacity: 0;
    pointer-events: none;
    z-index: 80;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    background: var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: 999px;
    box-shadow: 0 10px 24px rgba(15, 23, 42, 0.14);
    transition: all 0.2s ease;
}

body.is-dragging .trash-bin {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    pointer-events: auto;
}

.trash-bin.visible {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    pointer-events: auto;
}

.trash-icon {
    font-size: 1.125rem;
    width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(15, 23, 42, 0.55);
    transition: color 0.15s ease;
}

/* Patch 39: Hide label by default, show on hover/over */
.trash-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-muted);
    transition: all 0.15s ease;
    display: none;
}

.trash-bin.drag-over .trash-label {
    display: inline;
    font-weight: 700;
}

.trash-bin.drag-over {
    background: var(--danger-bg);
    border-color: var(--danger-border);
}

.trash-bin.drag-over .trash-icon {
    color: var(--danger);
}

.trash-bin.drag-over .trash-label {
    color: var(--danger);
}

/* =============================================================================
   Dark Mode Support
   ============================================================================= */

[data-theme="dark"] .tasks-panel {
    background: var(--bg-panel);
    border-color: var(--border-subtle);
}

[data-theme="dark"] .task-list-container {
    background: var(--bg-panel);
}

[data-theme="dark"] .task-list-header {
    background: var(--bg-panel);
    border-color: var(--border-default);
}

[data-theme="dark"] .header-task-label {
    color: var(--text-muted);
}

[data-theme="dark"] .header-energy-inline {
    background: rgba(109, 94, 246, 0.08);
    border-color: var(--border-strong);
}

[data-theme="dark"] .energy-label {
    color: var(--text-secondary);
}

[data-theme="dark"] .energy-pill-inline {
    border-color: var(--border-subtle);
}

[data-theme="dark"] .energy-pill-inline:hover {
    background: var(--interactive-hover);
    border-color: var(--border-default);
}

[data-theme="dark"] .energy-pill-inline.active {
    background: var(--primary-tint);
    border-color: rgba(109, 94, 246, 0.4);
}

[data-theme="dark"] .header-actions-btn {
    border-color: var(--border-default);
    background: rgba(109, 94, 246, 0.08);
    color: var(--text-secondary);
}

[data-theme="dark"] .header-actions-btn:hover {
    background: rgba(109, 94, 246, 0.12);
    border-color: var(--border-strong);
    color: var(--text-primary);
}

[data-theme="dark"] .task-list-options-menu {
    background: var(--bg-elevated);
    border-color: var(--border-default);
    box-shadow: var(--shadow-overlay);
}

[data-theme="dark"] .option-section + .option-section {
    border-color: var(--border-subtle);
}

[data-theme="dark"] .option-section-title {
    color: var(--text-muted);
}

/* Task rows */
[data-theme="dark"] .task-row {
    background: var(--bg-surface);
    border-color: var(--border-subtle);
}

[data-theme="dark"] .task-row:hover {
    background: var(--interactive-hover);
}

[data-theme="dark"] .task-row.scheduled {
    background: var(--bg-panel);
}

[data-theme="dark"] .task-title {
    color: var(--text-primary);
}

[data-theme="dark"] .task-title-text {
    color: inherit;
}

[data-theme="dark"] .task-domain-badge {
    background: var(--bg-panel);
    border-color: var(--border-subtle);
    color: var(--text-secondary);
}

/* Column headers */
[data-theme="dark"] .col-head,
[data-theme="dark"] .col-hd {
    color: var(--text-muted);
}

[data-theme="dark"] .col-head:hover,
[data-theme="dark"] .col-hd:hover {
    color: var(--text-secondary);
}

/* Task chips */
[data-theme="dark"] .task-duration,
[data-theme="dark"] .task-impact,
[data-theme="dark"] .task-clarity {
    background: var(--bg-panel);
    border-color: var(--border-subtle);
    color: var(--text-secondary);
}

/* Calendar panel */
[data-theme="dark"] .calendar-panel {
    background: var(--bg-panel);
    border-color: var(--border-subtle);
}

[data-theme="dark"] .calendar-header {
    background: var(--bg-surface);
    border-color: var(--border-default);
}

[data-theme="dark"] .calendar-title {
    color: var(--text-muted);
}

[data-theme="dark"] .calendar-nav-btn {
    border-color: var(--border-default);
    background: var(--bg-surface);
    color: var(--text-secondary);
}

[data-theme="dark"] .calendar-nav-btn:hover {
    background: var(--interactive-hover);
    color: var(--text-primary);
}

[data-theme="dark"] .today-btn {
    border-color: var(--border-default);
    background: var(--bg-surface);
    color: var(--text-secondary);
}

[data-theme="dark"] .today-btn:hover {
    background: var(--interactive-hover);
    color: var(--text-primary);
}

/* Calendar grid */
[data-theme="dark"] .calendar-body {
    background: var(--bg-surface);
}

[data-theme="dark"] .hour-slot {
    border-color: var(--border-subtle);
}

[data-theme="dark"] .hour-label {
    color: var(--text-muted);
}

[data-theme="dark"] .day-separator {
    border-color: var(--border-default);
}

/* Events */
[data-theme="dark"] .calendar-event {
    border-color: var(--border-subtle);
}

[data-theme="dark"] .calendar-event.gcal-event {
    background: var(--bg-panel);
}

[data-theme="dark"] .event-title {
    color: var(--text-primary);
}

[data-theme="dark"] .event-time {
    color: var(--text-secondary);
}

/* Plan mode */
[data-theme="dark"] .plan-btn {
    background: var(--bg-surface);
    border-color: var(--border-default);
    color: var(--text-secondary);
}

[data-theme="dark"] .plan-btn:hover {
    background: var(--interactive-hover);
    color: var(--text-primary);
}

[data-theme="dark"] .plan-btn.active {
    background: var(--primary-tint);
    border-color: rgba(109, 94, 246, 0.4);
    color: var(--primary);
}

/* Selection overlay */
[data-theme="dark"] .selection-overlay {
    background: rgba(109, 94, 246, 0.15);
    border-color: rgba(109, 94, 246, 0.4);
}

/* Anytime tasks */
[data-theme="dark"] .anytime-section {
    background: var(--bg-panel);
    border-color: var(--border-subtle);
}

[data-theme="dark"] .anytime-header {
    background: var(--bg-surface);
    border-color: var(--border-subtle);
    color: var(--text-secondary);
}

[data-theme="dark"] .anytime-task {
    background: var(--bg-surface);
    border-color: var(--border-subtle);
}

[data-theme="dark"] .anytime-task:hover {
    background: var(--interactive-hover);
}

/* Drop zones */
[data-theme="dark"] .drop-zone.drag-over {
    background: rgba(109, 94, 246, 0.12);
    border-color: rgba(109, 94, 246, 0.35);
}

/* Icon buttons */
[data-theme="dark"] .icon-btn {
    border-color: var(--border-subtle);
    background: var(--bg-surface);
    color: var(--text-secondary);
}

[data-theme="dark"] .icon-btn:hover {
    background: var(--interactive-hover);
    border-color: var(--border-default);
    color: var(--text-primary);
}

/* Trash bin */
[data-theme="dark"] .trash-bin {
    background: var(--bg-elevated);
    border-color: var(--border-default);
}

[data-theme="dark"] .trash-icon {
    color: var(--text-secondary);
}

[data-theme="dark"] .trash-label {
    color: var(--text-muted);
}

/* Completed tasks */
[data-theme="dark"] .task-row.completed-today {
    background: var(--bg-panel);
}

[data-theme="dark"] .task-row.completed-today .task-title-text {
    color: var(--text-muted);
}

[data-theme="dark"] .task-row.completed-older {
    background: var(--bg-panel);
    opacity: 0.6;
}
